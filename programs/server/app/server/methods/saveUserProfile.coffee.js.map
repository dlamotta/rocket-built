{"version":3,"sources":["meteor://ðŸ’»app/server/methods/saveUserProfile.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,mBAAiB,SAAC,QAAD;AAChB;AAAA,eAAa,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,iBAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAAM,CAAC,MAAP,EAApC,CAHP;AAKA,QAAG,CAAC,CAAC,IAAF,oFAA+B,CAAE,iCAAjC,KAA6C,SAAY,CAAC,eAA7D;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,wBAAb,EAAuC,kBAAvC,EAA2D;AAAA,QAAE,QAAQ,iBAAV;OAA3D,CAAV,CADD;KALA;AAQA,mBAAiB,CAAC,QAAQ,CAAC,GAApB,CAAwB,iCAAxB,CAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,mBAAb,EAAkC,aAAlC,EAAiD;AAAA,QAAE,QAAQ,iBAAV;OAAjD,CAAV,CADD;KARA;AAWA,QAAG,CAAC,CAAC,IAAF,sFAA+B,CAAE,iCAAjC,CAAH;AACC,kBAAY,QAAQ,CAAC,cAAT,CAAwB,IAAxB,EAA8B;AAAA,QAAE,QAAQ,QAAQ,CAAC,eAAnB;AAAA,QAAoC,WAAW,SAA/C;OAA9B,CAAZ;AACA,UAAG,SAAS,CAAC,KAAb;AACC,cAAU,UAAM,CAAC,KAAP,CAAa,wBAAb,EAAuC,kBAAvC,EAA2D;AAAA,UAAE,QAAQ,iBAAV;SAA3D,CAAV,CADD;OAFD;KAXA;AAgBA,QAAG,4BAAH;AACC,cAAQ,CAAC,WAAT,CAAqB,MAAM,CAAC,MAAP,EAArB,EAAsC,QAAQ,CAAC,WAA/C,EAA4D;AAAA,QAAE,QAAQ,KAAV;OAA5D,EADD;KAhBA;AAmBA,QAAG,yBAAH;AACC,YAAM,CAAC,IAAP,CAAY,aAAZ,EAA2B,QAAQ,CAAC,QAApC,EADD;KAnBA;AAsBA,QAAG,yBAAH;AACC,YAAM,CAAC,IAAP,CAAY,aAAZ,EAA2B,QAAQ,CAAC,QAApC,EADD;KAtBA;AAyBA,QAAG,sBAAH;AACC,YAAM,CAAC,IAAP,CAAY,UAAZ,EAAwB,QAAQ,CAAC,KAAjC,EADD;KAzBA;AAAA,IA4BA,UAAU,EA5BV;AAAA,IA8BA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,UAAxB,CAAmC,MAAM,CAAC,MAAP,EAAnC,EAAoD,OAApD,CA9BA;AAgCA,WAAO,IAAP,CAjCgB;EAAA,CAAjB;CADD","file":"/server/methods/saveUserProfile.coffee.js","sourcesContent":["Meteor.methods\n\tsaveUserProfile: (settings) ->\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'saveUserProfile' }\n\n\t\tuser = RocketChat.models.Users.findOneById Meteor.userId()\n\n\t\tif s.trim(user?.services?.password?.bcrypt) and not settings.currentPassword\n\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'saveUserProfile' })\n\n\t\tunless RocketChat.settings.get(\"Accounts_AllowUserProfileChange\")\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'saveUserProfile' })\n\n\t\tif s.trim(user?.services?.password?.bcrypt)\n\t\t\tpassCheck = Accounts._checkPassword(user, { digest: settings.currentPassword, algorithm: 'sha-256' });\n\t\t\tif passCheck.error\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'saveUserProfile' });\n\n\t\tif settings.newPassword?\n\t\t\tAccounts.setPassword Meteor.userId(), settings.newPassword, { logout: false }\n\n\t\tif settings.realname?\n\t\t\tMeteor.call 'setRealName', settings.realname\n\n\t\tif settings.username?\n\t\t\tMeteor.call 'setUsername', settings.username\n\n\t\tif settings.email?\n\t\t\tMeteor.call 'setEmail', settings.email\n\n\t\tprofile = {}\n\n\t\tRocketChat.models.Users.setProfile Meteor.userId(), profile\n\n\t\treturn true\n"]}