{"version":3,"sources":["meteor://ðŸ’»app/server/stream/messages.coffee"],"names":[],"mappings":";;;;;;;;;AACA;;AAAA,eAAmB,UAAM,CAAC,MAAP,CAAc,UAAd,CAAnB;;AAAA,YAEY,CAAC,WAAW,CAAC,KAAzB,CAA+B,SAAC,SAAD;AAC9B,SAAO,KAAP,CAD8B;AAAA,CAA/B,CAFA;;AAAA,YAKY,CAAC,WAAW,CAAC,IAAzB,CAA8B,SAAC,SAAD;AAC7B;AAAA;AACC,gBAAY,MAAM,CAAC,IAAP,CAAY,eAAZ,EAA6B,SAA7B,EAAwC,IAAI,CAAC,MAA7C,CAAZ;AAEA,QAAgB,UAAhB;AAAA,aAAO,KAAP;KAFA;AAIA,WAAO,IAAP,CALD;GAAA;AAOC,IADK,UACL;AAAA,WAAO,KAAP,CAPD;GAD6B;AAAA,CAA9B,CALA;;AAAA,IAiBC,UAAD,GAAiB,UAAM,CAAC,QAAP,CAAgB,eAAhB,CAjBjB;;AAAA,SAmBS,CAAC,UAAV,CAAqB,MAArB,CAnBA;;AAAA,SAqBS,CAAC,SAAV,CAAoB,SAAC,SAAD;AAInB;AAAA;AACC,gBAAY,MAAM,CAAC,IAAP,CAAY,eAAZ,EAA6B,SAA7B,EAAwC,IAAI,CAAC,MAA7C,CAAZ;AAEA,QAAgB,UAAhB;AAAA,aAAO,KAAP;KAFA;AAIA,WAAO,IAAP,CALD;GAAA;AAOC,IADK,UACL;AAAA,WAAO,KAAP,CAPD;GAJmB;AAAA,CAApB,CArBA;;AAAA,MAmCM,CAAC,OAAP,CAAe;AACd;AAAA,YAAU,EAAV;AAEA,MAAG,WAAc,CAAC,QAAQ,CAAC,GAApB,CAAwB,0BAAxB,CAAP;AACC,WAAO,CAAC,MAAR,GAAiB;AAAA,MAAE,YAAY,CAAd;KAAjB,CADD;GAFA;SAKA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,wCAA3B,CAAwE,UAAxE,EAAgF,OAAhF,CAAwF,CAAC,OAAzF,CACC;AAAA,WAAO,SAAC,MAAD;AACN,kBAAY,CAAC,IAAb,CAAkB,MAAM,CAAC,GAAzB,EAA8B,MAA9B;aACA,SAAS,CAAC,oBAAV,CAA+B,MAAM,CAAC,GAAtC,EAA2C,MAA3C,EAFM;IAAA,CAAP;AAAA,IAIA,SAAS,SAAC,MAAD;AACR,kBAAY,CAAC,IAAb,CAAkB,MAAM,CAAC,GAAzB,EAA8B,MAA9B;aACA,SAAS,CAAC,oBAAV,CAA+B,MAAM,CAAC,GAAtC,EAA2C,MAA3C,EAFQ;IAAA,CAJT;GADD,EANc;AAAA,CAAf,CAnCA","file":"/server/stream/messages.coffee.js","sourcesContent":["# COMPATIBILITY\noldMsgStream = new Meteor.Stream 'messages'\n\noldMsgStream.permissions.write (eventName) ->\n\treturn false\n\noldMsgStream.permissions.read (eventName) ->\n\ttry\n\t\tcanAccess = Meteor.call 'canAccessRoom', eventName, this.userId\n\n\t\treturn false if not canAccess\n\n\t\treturn true\n\tcatch e\n\t\treturn false\n# COMPATIBILITY\n\n\n@msgStream = new Meteor.Streamer 'room-messages'\n\nmsgStream.allowWrite('none')\n\nmsgStream.allowRead (eventName) ->\n\t# console.log('stream.permissions.read', this.userId, eventName);\n\t# return this.userId == eventName;\n\n\ttry\n\t\tcanAccess = Meteor.call 'canAccessRoom', eventName, this.userId\n\n\t\treturn false if not canAccess\n\n\t\treturn true\n\tcatch e\n\t\treturn false\n\n\nMeteor.startup ->\n\toptions = {}\n\n\tif not RocketChat.settings.get 'Message_ShowEditedStatus'\n\t\toptions.fields = { 'editedAt': 0 }\n\n\tRocketChat.models.Messages.findVisibleCreatedOrEditedAfterTimestamp(new Date(), options).observe\n\t\tadded: (record) ->\n\t\t\toldMsgStream.emit record.rid, record\n\t\t\tmsgStream.emitWithoutBroadcast record.rid, record\n\n\t\tchanged: (record) ->\n\t\t\toldMsgStream.emit record.rid, record\n\t\t\tmsgStream.emitWithoutBroadcast record.rid, record\n"]}